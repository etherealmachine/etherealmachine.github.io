<dom-module id="app-editpost">
	<script src="../bower_components/firebase/firebase.js"></script>
	<template>
		<form>
			<div class="form-group">
				<input
						name="title"
						type="text"
						class="form-control"
						placeholder$="{{ title }}"
						value$="{{ title }}" />
			</div>
			<div class="form-group">
				<textarea
						name="content"
						class="form-control"
						rows="15">
				</textarea>
			</div>
			<div class="form-group">
				<input
						name="tagString"
						type="text"
						class="form-control"
						placeholder$="{{ toTagString(tags) }}"
						value$="{{ toTagString(tags) }}" />
			</div>
			<div class="form-group">
				<button 
						type="submit"
						class="btn btn-primary"
						on-click="save">
					Save
				</button>
				<button 
						type="submit"
						class="btn btn-danger pull-right"
						on-click="delete">
					Delete	
				</button>
			</div>
		</form>
	</template>
	<script>
		Polymer({
			is: 'app-editpost',
			properties: {
				postid: String
	    },
	    ready: function() {
	    	var self = this;
				this.fb = new Firebase(
					'https://etherealmachine.firebaseio.com/posts/' + this.postid);
				this.title = '';
				this.content = '';
				this.tags = [];
	    	this.querySelector('textarea').innerHTML = this.content;
				this.fb.on('value', function(snapshot) {
					var post = snapshot.val();
					self.set('title', post.title);
					self.set('content', post.content);
					self.set('tags', post.tags);
		    	self.querySelector('textarea').innerHTML = self.content;
				});
	    },
	    toTagString: function(tagSet) {
				var tags = [];
				for (var tag in tagSet) {
					tags.push(tag);
				}
				return tags.join(' ');
	    },
	    toTagSet: function(tagString) {
	    	var tags = tagString.split(' ');
	    	var tagSet = {};
	    	for (var i = 0; i < tags.length; i++) {
	    		tagSet[tags[i]] = true;
	    	}
	    	return tagSet;
	    },
	    save: function(e) {
	    	e.preventDefault();
	    	var form = FormValues(e);
	    	this.fb.set({
	    		title: form['title'],
	    		content: form['content'],
	    		tags: this.toTagSet(form['tagString']),
	    		date: Date.now()
	    	});
	    },
	    delete: function(e) {
	    	e.preventDefault();
	    	this.fb.remove();
	    }
		});
	</script>
</dom-module>