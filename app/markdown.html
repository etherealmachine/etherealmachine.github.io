<dom-module id="app-markdown">
	<script src="../bower_components/marked/marked.min.js"></script>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
	<style></style>
	<template></template>
	<script>
		Polymer({
			is: 'app-markdown',
			properties: {
		    content: {
		    	type: String,
		    	observer: 'contentChanged'
		    }
		  },
			ready: function() {
			},
			contentChanged: function(newVal, oldVal) {
				if (newVal == undefined) {
					this.innerHTML = '<p></p>';
				} else if (newVal != oldVal) {
					this.innerHTML = marked(newVal);
					var blocks = this.querySelectorAll('code');
					for (var i = 0; i < blocks.length; i++) {
						var block = blocks[i];
						var result;
						if (block.classList[0] == 'lang-javascript') {
							result = eval(block.innerHTML);
						}
						hljs.highlightBlock(block);
						if (result != undefined) {
							var node = document.createElement('p');
							node.innerHTML = result;
							block.parentNode.insertBefore(node, block.nextSibling);
						}
					}
				}	
			}
		});
	</script>
</dom-module>
