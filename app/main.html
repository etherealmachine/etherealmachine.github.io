<dom-module id="app-main">
	<script src="../bower_components/firebase/firebase.js"></script>
	<script src="../bower_components/director/build/director.min.js"></script>
  <link rel="import" href="navbar.html">
  <link rel="import" href="post.html">
  <link rel="import" href="newpost.html">
	<template>
		<app-navbar></app-navbar>
		<div class="container">
			<template is="dom-repeat" items="{{ posts }}" observe="posts">
				<app-post postid="{{ item }}"></app-post>
			</template>
			<app-newpost class$="{{ show(authed) }}"></app-newpost>
	</template>
	<script>
		Polymer({
			is: 'app-main',
			ready: function() {
				var self = this;
				this.posts = [];
				this.fb = new Firebase(
					'https://etherealmachine.firebaseio.com/posts');
				this.fb.on('value', function(snapshot) {
					var posts = [];
					var val = snapshot.val();
					for (var id in val) {
						posts.push(id);
					}
					self.set('posts', posts);
				});
				this.authed = false;
				this.fb.onAuth(function(user) {
					self.set('authed', user != null && user.provider == 'password');
				});
			},
			show: function(v) {
				if (v) {
					return 'show';
				}
				return 'hide';
			}
		});
	</script>
</dom-module>